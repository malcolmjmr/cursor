var content=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode&&t.parentNode.removeChild(t)}function a(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function d(){return u(" ")}function p(){return u("")}function f(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function h(t,e){e=""+e,t.data!==e&&(t.data=e)}function m(t,e){t.value=null==e?"":e}function x(t,e,n,o){null==n?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}let $;function y(t){$=t}function b(){if(!$)throw new Error("Function called outside component initialization");return $}function v(t){b().$$.on_mount.push(t)}function w(){const t=b();return(e,n,{cancelable:o=!1}={})=>{const r=t.$$.callbacks[e];if(r){const i=function(t,e,{bubbles:n=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,o,e),r}(e,n,{cancelable:o});return r.slice().forEach((e=>{e.call(t,i)})),!i.defaultPrevented}return!0}}const E=[],k=[];let C=[];const N=[],P=Promise.resolve();let A=!1;function S(t){C.push(t)}const T=new Set;let I=0;function _(){if(0!==I)return;const t=$;do{try{for(;I<E.length;){const t=E[I];I++,y(t),L(t.$$)}}catch(t){throw E.length=0,I=0,t}for(y(null),E.length=0,I=0;k.length;)k.pop()();for(let t=0;t<C.length;t+=1){const e=C[t];T.has(e)||(T.add(e),e())}C.length=0}while(E.length);for(;N.length;)N.pop()();A=!1,T.clear(),y(t)}function L(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(S)}}const R=new Set;let O;function D(t,e){t&&t.i&&(R.delete(t),t.i(e))}function B(t,e,n,o){if(t&&t.o){if(R.has(t))return;R.add(t),O.c.push((()=>{R.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}else o&&o()}function U(t){t&&t.c()}function X(t,n,i,s){const{fragment:c,after_update:l}=t.$$;c&&c.m(n,i),s||S((()=>{const n=t.$$.on_mount.map(e).filter(r);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),l.forEach(S)}function H(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];C.forEach((o=>-1===t.indexOf(o)?e.push(o):n.push(o))),n.forEach((t=>t())),C=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function K(t,e){-1===t.$$.dirty[0]&&(E.push(t),A||(A=!0,P.then(_)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function M(e,r,i,s,c,a,u,d=[-1]){const p=$;y(e);const f=e.$$={fragment:null,ctx:[],props:a,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(p?p.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:r.target||p.$$.root};u&&u(f.root);let g=!1;if(f.ctx=i?i(e,r.props||{},((t,n,...o)=>{const r=o.length?o[0]:n;return f.ctx&&c(f.ctx[t],f.ctx[t]=r)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](r),g&&K(e,t)),n})):[],f.update(),g=!0,o(f.before_update),f.fragment=!!s&&s(f.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);f.fragment&&f.fragment.l(t),t.forEach(l)}else f.fragment&&f.fragment.c();r.intro&&D(e.$$.fragment),X(e,r.target,r.anchor,r.customElement),_()}y(p)}class j{$destroy(){H(this,1),this.$destroy=t}$on(e,n){if(!r(n))return t;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const t=o.indexOf(n);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function F(e){let n,o,r,i,d,p=e[0].label+"";return{c(){n=a("div"),o=u(p),g(n,"class","context-selector svelte-1rcno9g"),g(n,"title",r=e[0].title)},m(t,r){c(t,n,r),s(n,o),i||(d=f(n,"click",e[1]),i=!0)},p(t,[e]){1&e&&p!==(p=t[0].label+"")&&h(o,p),1&e&&r!==(r=t[0].title)&&g(n,"title",r)},i:t,o:t,d(t){t&&l(n),i=!1,d()}}}function q(t,e,n){let o,{scope:r="paragraph"}=e;const i=[{id:"sentence",label:"S",title:"Sentence Context"},{id:"paragraph",label:"¶",title:"Paragraph Context"},{id:"document",label:"D",title:"Document Context"}],s=w();return t.$$set=t=>{"scope"in t&&n(2,r=t.scope)},t.$$.update=()=>{4&t.$$.dirty&&n(0,o=i.find((t=>t.id===r))||i[0])},[o,function(){const t=(i.findIndex((t=>t.id===r))+1)%i.length;n(2,r=i[t].id),s("change",{scope:r})},r]}class z extends j{constructor(t){super(),M(this,t,q,F,i,{scope:2})}}function V(e){let n,o,r,i,d,p=e[0].label+"";return{c(){n=a("div"),o=u(p),g(n,"class","length-selector svelte-yehw13"),g(n,"title",r=e[0].title)},m(t,r){c(t,n,r),s(n,o),i||(d=f(n,"click",e[1]),i=!0)},p(t,[e]){1&e&&p!==(p=t[0].label+"")&&h(o,p),1&e&&r!==(r=t[0].title)&&g(n,"title",r)},i:t,o:t,d(t){t&&l(n),i=!1,d()}}}function Y(t,e,n){let o,{length:r="sentence"}=e;const i=[{id:"phrase",label:"P",title:"Phrase Output"},{id:"sentence",label:"S",title:"Sentence Output"},{id:"paragraph",label:"¶",title:"Paragraph Output"}],s=w();return t.$$set=t=>{"length"in t&&n(2,r=t.length)},t.$$.update=()=>{4&t.$$.dirty&&n(0,o=i.find((t=>t.id===r))||i[0])},[o,function(){const t=(i.findIndex((t=>t.id===r))+1)%i.length;n(2,r=i[t].id),s("change",{length:r})},r]}class W extends j{constructor(t){super(),M(this,t,Y,V,i,{length:2})}}function J(t,e,n){const o=t.slice();return o[5]=e[n],o[7]=n,o}function Q(e){let n;return{c(){n=a("div"),n.textContent="Type to filter prompts or enter custom instruction",g(n,"class","no-prompts svelte-1d4usk7")},m(t,e){c(t,n,e)},p:t,d(t){t&&l(n)}}}function G(t){let e,n=t[0],o=[];for(let e=0;e<n.length;e+=1)o[e]=Z(J(t,n,e));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=p()},m(t,n){for(let e=0;e<o.length;e+=1)o[e]&&o[e].m(t,n);c(t,e,n)},p(t,r){if(7&r){let i;for(n=t[0],i=0;i<n.length;i+=1){const s=J(t,n,i);o[i]?o[i].p(s,r):(o[i]=Z(s),o[i].c(),o[i].m(e.parentNode,e))}for(;i<o.length;i+=1)o[i].d(1);o.length=n.length}},d(t){!function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(o,t),t&&l(e)}}}function Z(t){let e,n,o,r,i,p,m=t[5].title+"";function x(){return t[3](t[7])}return{c(){e=a("div"),n=u(m),o=d(),g(e,"class",r="prompt-item "+(t[7]===t[1]?"selected":"")+" svelte-1d4usk7")},m(t,r){c(t,e,r),s(e,n),s(e,o),i||(p=f(e,"click",x),i=!0)},p(o,i){t=o,1&i&&m!==(m=t[5].title+"")&&h(n,m),2&i&&r!==(r="prompt-item "+(t[7]===t[1]?"selected":"")+" svelte-1d4usk7")&&g(e,"class",r)},d(t){t&&l(e),i=!1,p()}}}function tt(e){let n;function o(t,e){return t[0].length>0?G:Q}let r=o(e),i=r(e);return{c(){n=a("div"),i.c(),g(n,"class","prompt-list svelte-1d4usk7")},m(t,e){c(t,n,e),i.m(n,null)},p(t,[e]){r===(r=o(t))&&i?i.p(t,e):(i.d(1),i=r(t),i&&(i.c(),i.m(n,null)))},i:t,o:t,d(t){t&&l(n),i.d()}}}function et(t,e,n){let{prompts:o=[]}=e,{selectedIndex:r=0}=e;const i=w();function s(t){i("select",{index:t})}return t.$$set=t=>{"prompts"in t&&n(0,o=t.prompts),"selectedIndex"in t&&n(1,r=t.selectedIndex)},[o,r,s,t=>s(t)]}class nt extends j{constructor(t){super(),M(this,t,et,tt,i,{prompts:0,selectedIndex:1})}}function ot(t){let e,n,r,i,u,p,h,$,y,b,v,w;return r=new z({props:{scope:t[1]}}),r.$on("change",t[8]),h=new W({props:{length:t[2]}}),h.$on("change",t[9]),y=new nt({props:{prompts:t[3],selectedIndex:t[4]}}),y.$on("select",t[10]),{c(){e=a("div"),n=a("div"),U(r.$$.fragment),i=d(),u=a("input"),p=d(),U(h.$$.fragment),$=d(),U(y.$$.fragment),g(u,"class","assistant-input svelte-8qelg2"),g(u,"placeholder","Type your writing intention..."),g(n,"class","assistant-input-row svelte-8qelg2"),g(e,"class","assistant-container svelte-8qelg2"),x(e,"left",t[0].x+"px"),x(e,"top",t[0].y+"px")},m(o,l){c(o,e,l),s(e,n),X(r,n,null),s(n,i),s(n,u),t[12](u),m(u,t[5]),s(n,p),X(h,n,null),s(e,$),X(y,e,null),b=!0,v||(w=[f(u,"input",t[13]),f(u,"keydown",t[7])],v=!0)},p(t,[n]){const o={};2&n&&(o.scope=t[1]),r.$set(o),32&n&&u.value!==t[5]&&m(u,t[5]);const i={};4&n&&(i.length=t[2]),h.$set(i);const s={};8&n&&(s.prompts=t[3]),16&n&&(s.selectedIndex=t[4]),y.$set(s),(!b||1&n)&&x(e,"left",t[0].x+"px"),(!b||1&n)&&x(e,"top",t[0].y+"px")},i(t){b||(D(r.$$.fragment,t),D(h.$$.fragment,t),D(y.$$.fragment,t),b=!0)},o(t){B(r.$$.fragment,t),B(h.$$.fragment,t),B(y.$$.fragment,t),b=!1},d(n){n&&l(e),H(r),t[12](null),H(h),H(y),v=!1,o(w)}}}function rt(t,e,n){let{position:o={x:0,y:0}}=e,{context:r=""}=e,{contextScope:i="paragraph"}=e,{outputLength:s="sentence"}=e,{prompts:c=[]}=e,{selectedPromptIndex:l=0}=e,a="";const u=w();let d;return v((()=>{d&&d.focus()})),t.$$set=t=>{"position"in t&&n(0,o=t.position),"context"in t&&n(11,r=t.context),"contextScope"in t&&n(1,i=t.contextScope),"outputLength"in t&&n(2,s=t.outputLength),"prompts"in t&&n(3,c=t.prompts),"selectedPromptIndex"in t&&n(4,l=t.selectedPromptIndex)},[o,i,s,c,l,a,d,function(t){"Enter"===t.key?a.trim()?u("submit",{input:a}):c.length>0&&u("selectPrompt",{index:l}):"Escape"===t.key?u("close"):"ArrowDown"===t.key?(t.preventDefault(),u("navigatePrompt",{direction:1})):"ArrowUp"===t.key?(t.preventDefault(),u("navigatePrompt",{direction:-1})):"Tab"===t.key&&(t.shiftKey?(t.preventDefault(),u("cycleOutputLength")):(t.preventDefault(),u("cycleContextScope")))},function(t){u("changeScope",{scope:t.detail.scope})},function(t){u("changeLength",{length:t.detail.length})},function(t){u("selectPrompt",{index:t.detail.index})},r,function(t){k[t?"unshift":"push"]((()=>{d=t,n(6,d)}))},function(){a=this.value,n(5,a)}]}class it extends j{constructor(t){super(),M(this,t,rt,ot,i,{position:0,context:11,contextScope:1,outputLength:2,prompts:3,selectedPromptIndex:4})}}function st(t,e="paragraph"){return t&&at(t)?"TEXTAREA"===t.nodeName||"INPUT"===t.nodeName?function(t,e){const n=t.value||"",o=t.selectionStart;if("sentence"===e)return ct(n,o);if("paragraph"===e)return lt(n,o);if("document"===e)return{text:n,start:0,end:n.length};return{text:"",start:0,end:0}}(t,e):t.isContentEditable?function(t,e){const n=window.getSelection();if(!n.rangeCount)return{text:"",start:0,end:0};const o=n.getRangeAt(0),r=o.startContainer,i=o.startOffset;if("sentence"===e)return function(t,e){const n=t.textContent||"";return ct(n,e)}(r,i);if("paragraph"===e)return function(t,e){let n=t;for(;n&&!["P","DIV","LI","BLOCKQUOTE","H1","H2","H3","H4","H5","H6"].includes(n.nodeName);)n=n.parentNode;if(!n){return lt(t.textContent||"",e)}return{text:n.textContent.trim(),node:n,start:0,end:n.textContent.length}}(r,i);if("document"===e)return{text:t.textContent,start:0,end:t.textContent.length};return{text:"",start:0,end:0}}(t,e):{text:"",start:0,end:0}:{text:"",start:0,end:0}}function ct(t,e){const n=[".","!","?","\n"];let o=e;for(;o>0;)if(o--,n.includes(t[o])){o++;break}let r=e;for(;r<t.length;){if(n.includes(t[r])){r++;break}r++}return{text:t.substring(o,r).trim(),start:o,end:r}}function lt(t,e){const n=["\n\n","\r\n\r\n"];let o=e,r=!1;for(;o>0&&!r;){o--;for(const e of n)if(t.substring(o,o+e.length)===e){o+=e.length,r=!0;break}}r||(o=0);let i=e;for(r=!1;i<t.length&&!r;){for(const e of n)if(t.substring(i,i+e.length)===e){r=!0;break}r||i++}return{text:t.substring(o,i).trim(),start:o,end:i}}function at(t){return!!t&&(t.isContentEditable||"TEXTAREA"===t.nodeName||"INPUT"===t.nodeName&&["text","search","email","url"].includes(t.type))}function ut(t){let e,n;return e=new it({props:{position:t[1],context:t[2],contextScope:t[3],outputLength:t[4],prompts:t[6],selectedPromptIndex:t[5]}}),e.$on("submit",t[8]),e.$on("selectPrompt",t[9]),e.$on("changeScope",t[10]),e.$on("changeLength",t[11]),e.$on("navigatePrompt",t[12]),e.$on("close",t[7]),{c(){U(e.$$.fragment)},m(t,o){X(e,t,o),n=!0},p(t,n){const o={};2&n&&(o.position=t[1]),4&n&&(o.context=t[2]),8&n&&(o.contextScope=t[3]),16&n&&(o.outputLength=t[4]),32&n&&(o.selectedPromptIndex=t[5]),e.$set(o)},i(t){n||(D(e.$$.fragment,t),n=!0)},o(t){B(e.$$.fragment,t),n=!1},d(t){H(e,t)}}}function dt(t){let e,n,r=t[0]&&ut(t);return{c(){r&&r.c(),e=p()},m(t,o){r&&r.m(t,o),c(t,e,o),n=!0},p(t,[n]){t[0]?r?(r.p(t,n),1&n&&D(r,1)):(r=ut(t),r.c(),D(r,1),r.m(e.parentNode,e)):r&&(O={r:0,c:[],p:O},B(r,1,1,(()=>{r=null})),O.r||o(O.c),O=O.p)},i(t){n||(D(r),n=!0)},o(t){B(r),n=!1},d(t){r&&r.d(t),t&&l(e)}}}function pt(t){if(!t)return!1;if("TEXTAREA"===t.nodeName||"INPUT"===t.nodeName){const e=t.selectionStart,n=t.value;return 0===e||"\n"===n.charAt(e-1)}if(t.isContentEditable){const t=window.getSelection();if(!t.rangeCount)return!1;const e=t.getRangeAt(0),n=e.startContainer;if(0===e.startOffset){const t=n.previousSibling;return!t||("BR"===t.nodeName||"P"===t.nodeName||t.textContent.endsWith("\n"))}return!1}return!1}function ft(t,e,n){let o=!1,r=null,i={x:0,y:0},s="",c="paragraph",l="sentence",a=0,u=null,d=!0,p="",f="gpt-4";let g=[{id:1,title:"Rewrite clearly",text:"Rewrite this to make it clearer and more concise"},{id:2,title:"Expand on this",text:"Expand on this point with more details"},{id:3,title:"Make professional",text:"Rewrite this in a more professional tone"},{id:4,title:"Fix grammar",text:"Fix any grammar or spelling issues in this text"},{id:5,title:"Add examples",text:"Add some examples to illustrate this point"}],h=0,m=!1;var x;function $(t){t.isEnabled&&(d=t.isEnabled.newValue,d?(document.addEventListener("keydown",y),document.addEventListener("click",w)):(document.removeEventListener("keydown",y),document.removeEventListener("click",w),k())),t.apiKey&&(p=t.apiKey.newValue),t.selectedModel&&(f=t.selectedModel.newValue)}function y(t){if(d&&at(t.target))if(" "===t.key){const e=Date.now();m&&e-h<500?pt(t.target)||(E(t.target),t.preventDefault()):pt(t.target)&&E(t.target),h=e,m=!0}else m=!1,"Escape"===t.key&&o&&k()}function w(t){o&&null===t.target.closest("#writing-assistant-root")&&k()}function E(t,e){r=t,n(1,i=function(t){if(!t)return{x:0,y:0};if("TEXTAREA"===t.nodeName||"INPUT"===t.nodeName){const e=t.getBoundingClientRect();return{x:e.left+10,y:e.bottom+10}}if(t.isContentEditable){const t=window.getSelection();if(!t.rangeCount)return{x:0,y:0};const e=t.getRangeAt(0).getBoundingClientRect();return{x:e.left,y:e.bottom+5}}return{x:0,y:0}}(t));const l=st(t,c);n(2,s=l.text),C(t,l),n(0,o=!0)}function k(){n(0,o=!1),u&&(u.style.display="none")}function C(t,e){if(u)try{if(e.node){const t=e.node.getBoundingClientRect();u.style.top=`${t.top+window.scrollY}px`,u.style.left=`${t.left+window.scrollX}px`,u.style.width=`${t.width}px`,u.style.height=`${t.height}px`}else if("TEXTAREA"===t.nodeName||"INPUT"===t.nodeName){const e=t.getBoundingClientRect();u.style.top=`${e.top+window.scrollY}px`,u.style.left=`${e.left+window.scrollX}px`,u.style.width=`${e.width}px`,u.style.height=`${e.height}px`}u.style.display="block"}catch(t){console.error("Error highlighting context:",t),u.style.display="none"}}async function N(t){if(p)try{let e="You are a helpful writing assistant.";switch(l){case"phrase":e+=" Provide a brief phrase as response (3-7 words).";break;case"sentence":e+=" Provide a single complete sentence as response.";break;case"paragraph":e+=" Provide a full paragraph as response."}const n=`Context: ${s}\n\nInstruction: ${t}`,o=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({model:f,messages:[{role:"system",content:e},{role:"user",content:n}],temperature:.7,max_tokens:"paragraph"===l?250:"sentence"===l?60:20})}),i=await o.json();if(!o.ok)throw new Error(i.error?.message||"Failed to generate text");const c=i.choices[0].message.content.trim();r&&c&&function(t,e){if(t&&e)if("TEXTAREA"===t.nodeName||"INPUT"===t.nodeName){const n=t.selectionStart,o=t.selectionEnd,r=t.value.substring(0,n),i=t.value.substring(o);t.value=r+e+i;const s=n+e.length;t.selectionStart=s,t.selectionEnd=s,t.focus()}else if(t.isContentEditable){const t=window.getSelection();if(t.rangeCount){const n=t.getRangeAt(0);n.deleteContents();const o=document.createTextNode(e);n.insertNode(o),n.setStartAfter(o),n.setEndAfter(o),t.removeAllRanges(),t.addRange(n)}}}(r,c)}catch(t){console.error("Error generating text:",t),alert(`Error: ${t.message||"Failed to generate text"}`)}else alert("Please set your API key in the extension settings.")}return v((()=>{chrome.storage.sync.get(["isEnabled","apiKey","selectedModel"],(t=>{d=void 0===t.isEnabled||t.isEnabled,p=t.apiKey||"",f=t.selectedModel||"gpt-4",d&&(document.addEventListener("keydown",y),document.addEventListener("click",w))})),u=document.createElement("div"),u.className="writing-assistant-context-highlight",u.style.display="none",document.body.appendChild(u),function(){const t=document.createElement("style");t.textContent="\n      #writing-assistant-root {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 0;\n        height: 0;\n        overflow: visible;\n        z-index: 9999;\n      }\n      \n      .writing-assistant-context-highlight {\n        position: absolute;\n        background-color: rgba(255, 255, 0, 0.2);\n        border-radius: 2px;\n        pointer-events: none;\n        z-index: 9998;\n      }\n    ",document.head.appendChild(t)}(),chrome.storage.onChanged.addListener($)})),x=()=>{document.removeEventListener("keydown",y),document.removeEventListener("click",w),chrome.storage.onChanged.removeListener($),u&&u.parentNode&&u.parentNode.removeChild(u)},b().$$.on_destroy.push(x),[o,i,s,c,l,a,g,k,async function(t){const e=t.detail.input;await N(e),k()},async function(t){const e=g[t.detail.index];await N(e.text),k()},function(t){if(n(3,c=t.detail.scope),r){const t=st(r,c);n(2,s=t.text),C(r,t)}},function(t){n(4,l=t.detail.length)},function(t){const e=t.detail.direction;n(5,a=(a+e+g.length)%g.length)}]}console.log("Writing Assistant: Content script loaded");const gt=document.createElement("div");gt.id="writing-assistant-root",document.body.appendChild(gt);return new class extends j{constructor(t){super(),M(this,t,ft,dt,i,{})}}({target:gt})}();
